# 贪吃蛇游戏 (Snake Game)

一个使用Python和Pygame库开发的经典贪吃蛇游戏。

## 功能特点

- 使用键盘方向键（↑↓←→）控制蛇的移动
- 吃到食物后蛇身变长，并随机生成新的食物
- 碰撞检测：撞墙或撞到自身游戏结束
- 显示实时得分
- 游戏结束后按空格键重新开始
- 支持暂停功能（按P键）
- 支持音效和背景音乐（M键控制音乐，S键控制音效）
- 完整的中文界面支持
- 最高分记录系统（保存前10名最高分）
- 稳定的蛇移动控制系统

## 安装与运行

1. 确保已安装Python（建议Python 3.11+）
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
3. 运行游戏：
   ```bash
   python src/main.py
   ```

## 使用说明

- **开始游戏**：运行程序后在主菜单选择"开始游戏"。
- **控制蛇**：使用键盘方向键（↑、↓、←、→）控制蛇的移动方向。
- **暂停/继续**：按P键可以暂停游戏，再按P键继续。
- **重新开始**：游戏结束后，按空格键重新开始游戏。
- **音效控制**：
  - M键：开启/关闭背景音乐
  - S键：开启/关闭音效
- **查看最高分**：在主菜单中选择"最高分"查看历史最高分记录。

## 游戏规则

- 控制蛇吃到食物（红色方块）来增加长度。
- 避免撞到墙壁或蛇自己的身体。
- 每吃到一个食物得1分。
- 游戏结束时，如果得分足够高，将被记录在最高分榜中。
- 最高分榜保存前10名最高分记录。

## 最近更新

1. 修复了蛇的移动控制系统：
   - 优化了方向改变逻辑，防止快速按键导致的意外转向
   - 修正了方向键响应问题
   
2. 改进了最高分系统：
   - 分数记录保存在 `data/high_scores.json` 文件中
   - 使用JSON格式存储分数记录
   - 自动保存并更新最高分记录
   - 显示前10名最高分

## 项目结构

```
tanchishe/
├── assets/                # 游戏资源文件目录
│   ├── fonts/            # 字体文件
│   │   └── WenQuanYiMicroHei.ttf  # 文泉驿微米黑字体
│   └── sounds/           # 音效文件
│       ├── move.wav          # 移动音效
│       ├── eat.wav           # 吃食物音效
│       ├── crash.wav         # 碰撞音效
│       ├── menu_select.wav   # 菜单选择音效
│       └── background.wav    # 背景音乐
├── data/                 # 数据文件目录
│   └── high_scores.json  # 最高分记录文件
├── src/                  # 源代码目录
│   ├── main.py          # 游戏入口文件
│   ├── snake.py         # 蛇类定义
│   ├── food.py          # 食物类定义
│   ├── settings.py      # 游戏配置和常量
│   ├── game_state.py    # 游戏状态管理
│   ├── ui_manager.py    # UI管理器
│   ├── sound_manager.py # 声音管理器
│   └── sound_generator.py # 音效生成器
├── tests/               # 测试文件目录
│   ├── __init__.py
│   ├── test_food.py    # 食物类测试
│   ├── test_snake.py   # 蛇类测试
│   ├── test_game_state.py # 游戏状态测试
│   └── test_sound_manager.py # 声音管理器测试
├── install.sh          # 安装脚本
├── requirements.txt    # 项目依赖
└── README.md          # 项目说明文档
```

## 模块说明

### 核心模块
1. **游戏主模块 (main.py)**
   - 游戏主循环
   - 事件处理
   - 游戏状态更新
   - 画面渲染

2. **蛇类 (snake.py)**
   - 蛇的移动逻辑
   - 方向控制
   - 碰撞检测
   - 生长机制

3. **食物系统 (food.py)**
   - 食物位置生成
   - 碰撞检测
   - 重生机制

4. **游戏状态 (game_state.py)**
   - 游戏状态管理
   - 分数系统
   - 最高分记录
   - 状态转换逻辑

### 界面和音效
1. **UI管理器 (ui_manager.py)**
   - 菜单界面
   - 游戏界面
   - 按钮系统
   - 分数显示

2. **声音系统**
   - **声音管理器 (sound_manager.py)**
     * 音效控制
     * 背景音乐
     * 音量调节
   - **音效生成器 (sound_generator.py)**
     * 动态音效生成
     * 音效文件保存

### 配置模块
1. **游戏设置 (settings.py)**
   - 窗口设置
   - 游戏参数
   - 颜色定义
   - 控制键映射

### 测试模块
- 单元测试覆盖核心功能
- 包含食物、蛇、游戏状态和声音系统的测试
- 使用 pytest 框架

## 字体说明

本游戏使用文泉驿微米黑字体（WenQuanYiMicroHei）作为默认字体，这是一个开源的中文字体。
字体许可证：GPL-2.0 with Font Exception

## 许可证

MIT License

## 技术架构

### 核心组件

1. **游戏引擎 (game.py)**
   - 管理游戏主循环
   - 处理事件监听
   - 控制游戏状态
   - 协调各个组件

2. **蛇类 (snake.py)**
   - 蛇的移动逻辑
   - 身体增长机制
   - 方向控制
   - 碰撞边界检查

3. **食物系统 (food.py)**
   - 随机生成食物
   - 食物类型管理
   - 特殊食物效果

4. **工具模块 (utils/)**
   - 碰撞检测算法
   - 分数记录和排行榜
   - 配置文件管理

### 技术选型

- **Pygame**: 游戏主框架
  - 图形渲染
  - 事件处理
  - 音效管理
  
- **SQLite**: 本地数据存储
  - 保存游戏记录
  - 玩家排行榜

## 功能优先级和开发顺序

### P0（核心功能 - 第一阶段）
1. 基础游戏循环
   - 蛇的移动控制 ✓
   - 基本碰撞检测 ✓
   - 食物生成系统 ✓
   - 得分系统 ✓

### P1（重要功能 - 第二阶段）
1. 游戏界面优化
   - 开始界面
   - 游戏结束界面
   - 暂停菜单
2. 游戏设置
   - 难度选择
   - 速度调节
   - 地图大小选择

### P2（增强功能 - 第三阶段）
1. 视觉升级
   - 蛇的精灵图设计
   - 食物动画效果
   - 背景主题切换
2. 音效系统
   - 移动音效
   - 吃食物音效
   - 背景音乐

### P3（额外功能 - 第四阶段）
1. 排行榜系统
   - 本地记录保存
   - 最高分显示
2. 特殊食物
   - 加速食物
   - 减速食物
   - 双倍得分

## 开发计划

1. **第一周期（P0）**
   - 完成核心游戏逻辑
   - 实现基本移动和碰撞
   - 建立基础得分系统

2. **第二周期（P1）**
   - 开发游戏界面
   - 实现设置系统
   - 添加难度选择

3. **第三周期（P2）**
   - 设计和实现精灵图
   - 添加动画效果
   - 集成音效系统

4. **第四周期（P3）**
   - 开发排行榜功能
   - 实现特殊食物系统
   - 优化游戏体验

## 开发环境

- Python 3.11+
- Pygame 2.5.0+
- IDE: VS Code（推荐）
- 操作系统: Windows/MacOS/Linux

## 调试和测试

1. **单元测试**
   ```bash
   python -m pytest tests/
   ```

2. **代码风格检查**
   ```bash
   flake8 src/
   ```

## 贡献指南

1. Fork 项目
2. 创建特性分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 游戏完善和迭代计划

### 一、游戏基础体验优化

1. **游戏界面优化**
   - 添加开始界面，显示游戏标题和操作说明
   - 设计游戏结束界面，显示最终得分和历史最高分
   - 增加暂停菜单，提供继续游戏、重新开始、退出等选项
   - 添加背景音乐和音效（移动、吃食物、撞墙音效）

2. **视觉效果提升**
   - 使用精美的蛇身设计，替代当前的方块
   - 为蛇头设计特殊外观，更容易识别方向
   - 添加食物的动画效果（旋转、闪烁）
   - 设计多套主题（日间/夜间模式、森林/沙漠场景等）

### 二、游戏机制深化

1. **难度系统**
   - 提供多个难度级别（简单、普通、困难）
   - 随着得分提高自动增加难度
   - 不同难度对应不同的：
     * 蛇的移动速度
     * 地图大小
     * 障碍物数量
     * 特殊食物出现频率

2. **特殊食物系统**
   - 金苹果：双倍得分
   - 速度果：临时改变蛇的速度
   - 穿墙果：获得短暂穿墙能力
   - 缩短果：蛇身临时缩短
   - 特殊食物持续时间有限

3. **地图与障碍**
   - 设计多种地图布局
   - 添加固定障碍物
   - 设计移动的障碍物
   - 添加传送门机制

### 三、游戏玩法扩展

1. **计分系统升级**
   - 连续吃食物有额外加分
   - 根据移动路径的复杂度加分
   - 快速通过危险区域奖励分数
   - 设计成就系统

2. **多人对战模式**
   - 双人本地对战
   - 网络对战功能
   - 多人竞技场模式
   - 团队合作模式

3. **任务与挑战**
   - 每日任务系统
   - 特殊挑战关卡
   - 限时模式
   - 生存模式

### 四、社交与进度系统

1. **排行榜系统**
   - 本地最高分记录
   - 全球排行榜
   - 好友排行榜
   - 每周/月度排行榜

2. **个性化定制**
   - 蛇的皮肤自定义
   - 食物外观选择
   - 地图主题选择
   - 音效自定义

3. **成就系统**
   - 游戏时长成就
   - 特殊操作成就
   - 连胜成就
   - 收集成就

### 五、技术提升方向

1. **性能优化**
   - 使用精灵系统优化渲染
   - 添加画面平滑处理
   - 优化碰撞检测算法
   - 实现游戏状态保存

2. **跨平台支持**
   - 移动端适配
   - 触屏控制优化
   - 键盘/手柄支持
   - 云存档功能

### 六、教程与引导

1. **新手引导**
   - 交互式教程关卡
   - 技巧提示系统
   - 进阶操作指导
   - 成就解锁提示

2. **游戏帮助**
   - 详细的操作说明
   - 游戏机制说明
   - 特殊道具说明
   - 常见问题解答

## 开发优先级

1. **第一阶段：基础体验优化**
   - 完善游戏界面
   - 提升视觉效果
   - 添加基本音效

2. **第二阶段：核心玩法升级**
   - 实现难度系统
   - 添加特殊食物
   - 设计基础地图系统

3. **第三阶段：游戏机制扩展**
   - 升级计分系统
   - 添加成就系统
   - 实现本地排行榜

4. **第四阶段：多人与社交**
   - 开发多人对战模式
   - 实现全球排行榜
   - 添加社交功能

5. **第五阶段：完善与优化**
   - 性能优化
   - 跨平台支持
   - 云存档功能

每个功能的具体实现将基于用户反馈和游戏数据分析来调整优先级，确保游戏体验的持续提升。