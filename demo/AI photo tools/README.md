# AI 图片生成工具

## 目录
- [项目概述](#项目概述)
- [核心功能](#核心功能)
- [UI/UX设计规范](#uiux设计规范)
- [项目实现](#项目实现)
  - [技术架构](#1-技术架构)
  - [核心功能](#2-核心功能)
  - [文件结构](#3-文件结构)
  - [API 集成](#4-api-集成)
- [如何使用](#5-如何使用)
- [部署说明](#6-部署说明)
- [配置说明](#7-配置说明)
- [故障排除](#8-故障排除)
- [未来改进方向](#9-未来改进方向)
- [技术支持](#技术支持)
- [最新更新说明](#最新更新说明)
- [许可证](#许可证)

## 项目概述

**目标**：开发一个美观、交互流畅的「AI对话生成图片」网页应用，支持用户输入文本描述并实时生成图片，需兼顾功能性与视觉体验。

## 核心功能

### 1. 用户输入界面  
- 提供优雅的**多行文本输入框**，支持提示词输入（如："一只穿着宇航服的柴犬，太空背景，卡通风格"）。  
- 添加**参数调节组件**（可选）：  
  - 图片尺寸下拉菜单（512×512, 1024×1024）。  
  - 风格选择（写实/动漫/水彩等）。  
- 提交按钮设计为**动态加载状态**（点击后显示旋转图标）。  

### 2. AI图片生成与展示  
- 调用AI图片生成API（如OpenAI DALL·E、Stable Diffusion等）。  
- 图片加载时显示**占位骨架屏**（Skeleton Loading），提升等待体验。  
- 生成后的图片以**卡片瀑布流**布局展示，支持点击放大预览。  

### 3. 历史记录与交互  
- 本地存储用户生成记录（LocalStorage），支持查看历史作品。  
- 每张图片提供**下载按钮**（PNG/JPEG）和**分享链接**。
- 支持**图片删除功能**，包括软删除和永久删除选项。
- 自动清理过期图片，优化存储空间。

## UI/UX设计规范  

### 1. 视觉风格  
- **配色方案**：深色模式为主（降低长时间使用疲劳），搭配AI科技感渐变色（如`#6e48aa`到`#9f50ac`）。  
- **字体选择**：  
  - 标题：`"Inter"`（现代无衬线，加粗）。  
  - 正文：`"Roboto"`（易读性强）。  
- **圆角与阴影**：卡片圆角`12px`，柔和阴影（`box-shadow: 0 4px 12px rgba(0,0,0,0.1)`）。  

### 2. 布局结构  
```html
<div class="app-container">
  <!-- 左侧输入区 -->
  <div class="input-panel">
    <textarea placeholder="描述你想要的画面..."></textarea>
    <div class="controls">
      <select><option>512×512</option></select>
      <button>生成</button>
    </div>
  </div>
  
  <!-- 右侧展示区 -->
  <div class="gallery">
    <div class="image-card loading"></div> <!-- 骨架屏 -->
    <div class="image-card">
      <img src="ai-generated-image.png">
      <button class="download-btn">↓ 下载</button>
    </div>
  </div>
</div>
```

### 3. 交互动效  
- 输入框聚焦时边框渐变色流动效果（CSS `:focus-within`）。  
- 图片生成后淡入入场（`@keyframes fadeIn`）。  
- 按钮微交互（悬停时轻微放大，点击下沉效果）。  

## 项目实现

本项目已经实现了一个基于纯HTML/CSS/JavaScript的AI图片生成工具，通过Cloudflare Worker和R2存储实现了真实的AI图像生成功能，具有以下特点：

### 1. 技术架构

- **前端**：纯HTML/CSS/JavaScript实现
- **API代理**：Cloudflare Worker处理API请求和CORS问题
- **图片存储**：Cloudflare R2存储生成的图片
- **AI引擎**：硅基流动API (Silicon Flow) 提供图像生成服务

### 2. 核心功能

- **美观的深色UI设计**
  - 采用深色主题搭配紫色渐变色调
  - 使用Inter和Roboto字体增强现代感
  - 精心设计的卡片、按钮和交互元素

- **完整的用户交互流程**
  - 文本输入区支持多行输入
  - 图片尺寸和风格选择
  - 高级选项（生成步数、引导强度等）
  - 生成按钮带加载状态
  - API连接状态指示

- **增强的用户体验**
  - 骨架屏加载效果
  - 图片点击放大预览
  - 历史记录面板
  - 下载和分享功能
  - 通知系统

- **本地存储功能**
  - 使用localStorage保存历史记录
  - 自动加载历史图片

- **图片管理功能**
  - 支持软删除（仅从本地记录中移除）
  - 支持永久删除（从R2存储中彻底删除）
  - 自动清理30天前已标记删除的图片
  - 批量清理过期图片功能

- **响应式设计**
  - 适配移动端和桌面端
  - 流畅的动画和过渡效果

### 3. 文件结构

- `index.html` - 主页面结构
- `styles.css` - 样式表
- `settings.js` - 全局配置文件
- `script.js` - 主要交互逻辑
- `r2-worker.js` - Cloudflare Worker代码
- `wrangler.toml` - Cloudflare Worker配置文件
- `test-api-connection.html/js` - API连接测试工具

### 4. API 集成

本项目使用Cloudflare Worker作为中间层，处理以下任务：

1. **API代理**：解决前端直接调用AI服务API的CORS问题
2. **图片存储**：将生成的图片保存到Cloudflare R2存储桶
3. **安全性**：隐藏API密钥，只在服务器端使用

Worker提供的主要API端点：
- `/api/test-connection` - 测试API连接状态
- `/api/generate-image` - 生成并存储AI图像
- `/api/delete-image` - 删除指定图片
- `/api/cleanup-images` - 批量清理图片
- `/image/{fileName}` - 获取存储的图片

### 5. 如何使用

1. 在文本框中输入你想要生成的图片描述
2. 选择图片尺寸和风格
3. 根据需要调整高级选项
4. 点击"生成图片"按钮
5. 等待图片生成（通常需要10-30秒）
6. 点击图片可查看大图，并可下载或分享
7. 管理图片：
   - 点击图片查看大图后，可以选择"标记删除"或"永久删除"
   - "标记删除"只会从本地记录中移除，不会删除云端存储
   - "永久删除"会同时从本地记录和云端存储中删除图片
   - 标记删除30天后的图片会被自动清理

### 6. 部署说明

#### 前端部署
直接将所有前端文件上传到任何静态网站托管服务即可使用。

#### Cloudflare Worker部署
1. 安装Cloudflare Wrangler CLI：
   ```bash
   npm install -g wrangler
   ```
2. 登录到Cloudflare账户：
   ```bash
   wrangler login
   ```
3. 创建R2存储桶：
   ```bash
   wrangler r2 bucket create ai-generated-images
   ```
4. 更新`wrangler.toml`中的配置
5. 部署Worker：
   ```bash
   wrangler deploy
   ```

### 7. 配置说明

在`settings.js`文件中可以配置以下内容：

- Worker URL
- CORS代理设置
- 默认模型参数
- UI和存储选项

### 8. 故障排除

如果"生成图片"按钮无响应，请尝试以下步骤：

1. 检查浏览器控制台是否有错误信息
2. 确认API连接状态（点击头部的API状态指示器）
3. 尝试点击"API测试"按钮进行连接测试
4. 确保`settings.js`中的Worker URL配置正确
5. 检查Cloudflare Worker是否正常运行

### 9. 未来改进方向

1. 添加更多AI模型支持（如DALL-E、Midjourney等）
2. 增加图像编辑功能（如简单的滤镜、裁剪等）
3. 实现云端存储和用户账户系统
4. 增加提示词助手功能
5. 优化移动端体验和性能
6. 添加图片恢复功能（从已删除状态恢复）
7. 实现图片分类和标签管理

## 技术支持

如有任何问题或建议，请提交Issue或联系项目维护者。

更多API详情，请参考[API文档](./API.md)。

## 许可证

MIT License

## 最新更新说明

### 图片删除功能实现 (2025-06-25)

我们添加了全新的图片删除和管理功能，主要改进包括：

1. 图片删除系统：
   - 添加了软删除功能 - 仅从本地记录中移除，保留云端存储
   - 添加了永久删除功能 - 同时从本地和云端删除
   - 实现了自动清理机制，30天后自动清理已标记删除的图片

2. 后端API扩展：
   - 新增 `/api/delete-image` 端点用于删除单张图片
   - 新增 `/api/cleanup-images` 端点用于批量清理图片
   - 支持按文件名或日期范围删除图片

3. 用户界面改进：
   - 在图片预览模态框中添加删除按钮
   - 为删除操作添加确认提示，防止误操作
   - 添加操作结果通知

4. 性能优化：
   - 优化历史记录显示，只显示未删除的图片
   - 添加定时清理机制，减少存储占用
   - 改进画廊显示逻辑，提高加载速度

这些功能让用户可以更好地管理自己生成的图片，避免存储空间浪费，同时保持界面整洁。


### 注意事项

- 硅基流动API的可用模型可能会定期更新，如果将来再次遇到"Model does not exist"错误，请检查最新的可用模型列表
- 可以通过API测试工具或调用`/api/test-connection`端点获取当前可用的模型列表

如有任何问题，请联系项目维护者获取支持。