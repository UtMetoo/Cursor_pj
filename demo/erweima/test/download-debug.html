<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‹è½½åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body {
            font-family: "SF Pro Text", "PingFang SC", "Microsoft YaHei", sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .qr-preview {
            width: 200px;
            height: 200px;
            margin: 10px 0;
            border: 1px solid #ccc;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qr-preview svg {
            width: 100%;
            height: 100%;
        }
        
        button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .success {
            color: #28a745;
        }
        
        .error {
            color: #dc3545;
        }
        
        .warning {
            color: #ffc107;
        }
        
        .info {
            color: #17a2b8;
        }
        
        .removed-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            opacity: 0.7;
        }
        
        .removed-section h2 {
            color: #6c757d;
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <h1>ä¸‹è½½åŠŸèƒ½è°ƒè¯•é¡µé¢</h1>
    <p>è¿™ä¸ªé¡µé¢å¸®åŠ©è°ƒè¯•äºŒç»´ç ä¸‹è½½åŠŸèƒ½ï¼Œç°åœ¨ç»Ÿä¸€ä½¿ç”¨ ZXingRenderer.exportToPNG æ–¹æ³•</p>
    
    <div class="test-section">
        <h2>âœ… ä½¿ç”¨ ZXingRenderer.exportToPNGï¼ˆæ¨èä¸”å”¯ä¸€æ–¹æ³•ï¼‰</h2>
        <div class="qr-preview" id="preview1"></div>
        <button onclick="testMethod1()">ç”ŸæˆäºŒç»´ç </button>
        <button onclick="downloadMethod1()">ä¸‹è½½PNG</button>
        <div class="log" id="log1">ç­‰å¾…æ“ä½œ...</div>
    </div>
    
    <div class="test-section removed-section">
        <h2>âŒ åŸ renderSVGToCanvas æ–¹æ³•ï¼ˆå·²ç§»é™¤ï¼‰</h2>
        <p style="color: #666; font-style: italic;">
            âœ… renderSVGToCanvas æ–¹æ³•å·²è¢«ç§»é™¤ï¼Œç°åœ¨ç»Ÿä¸€ä½¿ç”¨ ZXingRenderer.exportToPNG æ–¹æ³•ï¼Œä»£ç æ›´ç®€æ´å¯é 
        </p>
        <div class="log" id="log2">æ­¤æ–¹æ³•å·²è¢«ç§»é™¤ï¼Œä»¥ç®€åŒ–ä»£ç ç»“æ„å¹¶æé«˜å¯é æ€§</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” å¤šé…è‰²æµ‹è¯•</h2>
        <button onclick="runColorTests()">è¿è¡Œå¤šé…è‰²æµ‹è¯•</button>
        <div class="log" id="color-test-log">ç­‰å¾…æµ‹è¯•...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æ€§èƒ½æµ‹è¯•</h2>
        <button onclick="runPerformanceTest()">è¿è¡Œæ€§èƒ½æµ‹è¯•</button>
        <div class="log" id="performance-log">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <!-- åŠ è½½ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@latest/umd/index.min.js"></script>
    <script src="../src/renderers/zxing/svgBuilder.js"></script>
    <script src="../src/renderers/zxing/colorManager.js"></script>
    <script src="../src/renderers/zxing/ZXingRenderer.js"></script>
    <script src="../src/generators/logo-manager.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let renderer;
        let svg1;
        
        // åˆå§‹åŒ–
        function init() {
            renderer = new ZXingRenderer({
                size: 200,
                foreground: '#000000',
                background: '#FFFFFF',
                errorCorrectionLevel: 'H',
                margin: 0.5
            });
            
            // æ˜¾ç¤ºåˆå§‹åŒ–çŠ¶æ€
            document.getElementById('log1').innerHTML = '<span class="info">âœ“ ZXingRenderer åˆå§‹åŒ–å®Œæˆ</span>';
        }
        
        // æµ‹è¯•ç”ŸæˆäºŒç»´ç 
        window.testMethod1 = async function() {
            const log = document.getElementById('log1');
            log.innerHTML = '<span class="warning">æ­£åœ¨ç”ŸæˆäºŒç»´ç ...</span>';
            
            try {
                svg1 = await renderer.generate('æµ‹è¯•å†…å®¹ï¼šä½¿ç”¨ç»Ÿä¸€çš„ ZXingRenderer.exportToPNG æ–¹æ³•');
                document.getElementById('preview1').innerHTML = '';
                document.getElementById('preview1').appendChild(svg1);
                log.innerHTML = '<span class="success">âœ“ äºŒç»´ç ç”ŸæˆæˆåŠŸ</span>';
            } catch (error) {
                log.innerHTML = `<span class="error">âœ— ç”Ÿæˆå¤±è´¥: ${error.message}</span>`;
            }
        };
        
        // ä¸‹è½½äºŒç»´ç 
        window.downloadMethod1 = async function() {
            const log = document.getElementById('log1');
            if (!svg1) {
                log.innerHTML = '<span class="error">âœ— è¯·å…ˆç”ŸæˆäºŒç»´ç </span>';
                return;
            }
            
            log.innerHTML = '<span class="warning">æ­£åœ¨ä¸‹è½½...</span>';
            
            try {
                const startTime = performance.now();
                const pngUrl = await renderer.exportToPNG('æµ‹è¯•å†…å®¹ï¼šä½¿ç”¨ç»Ÿä¸€çš„ ZXingRenderer.exportToPNG æ–¹æ³•');
                const endTime = performance.now();
                
                const downloadLink = document.createElement('a');
                downloadLink.href = pngUrl;
                downloadLink.download = `qrcode-unified-method-${Date.now()}.png`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                log.innerHTML = `<span class="success">âœ“ ä¸‹è½½æˆåŠŸ (${(endTime - startTime).toFixed(2)}ms)</span>`;
            } catch (error) {
                log.innerHTML = `<span class="error">âœ— ä¸‹è½½å¤±è´¥: ${error.message}</span>`;
            }
        };
        
        // å¤šé…è‰²æµ‹è¯•
        window.runColorTests = async function() {
            const log = document.getElementById('color-test-log');
            log.innerHTML = '<span class="warning">æ­£åœ¨è¿è¡Œå¤šé…è‰²æµ‹è¯•...</span><br>';
            
            const testColors = [
                { name: 'ç»å…¸é»‘ç™½', fg: '#000000', bg: '#FFFFFF' },
                { name: 'è“åº•ç™½å­—', fg: '#FFFFFF', bg: '#2196F3' },
                { name: 'ç»¿åº•é»‘å­—', fg: '#000000', bg: '#4CAF50' },
                { name: 'çº¢åº•ç™½å­—', fg: '#FFFFFF', bg: '#F44336' },
                { name: 'é»„åº•é»‘å­—', fg: '#000000', bg: '#FFEB3B' },
                { name: 'ç´«åº•ç™½å­—', fg: '#FFFFFF', bg: '#9C27B0' }
            ];
            
            const testContent = 'å¤šé…è‰²æµ‹è¯•ï¼šä¸­æ–‡æµ‹è¯• + English Test + 123456';
            
            for (const color of testColors) {
                log.innerHTML += `<br><strong>${color.name}é…è‰²æµ‹è¯•ï¼š</strong><br>`;
                
                try {
                    const testRenderer = new ZXingRenderer({
                        size: 200,
                        foreground: color.fg,
                        background: color.bg,
                        errorCorrectionLevel: 'H',
                        margin: 0.5
                    });
                    
                    const startTime = performance.now();
                    const pngUrl = await testRenderer.exportToPNG(testContent);
                    const endTime = performance.now();
                    
                    log.innerHTML += `  <span class="success">âœ“ æˆåŠŸ</span> (${(endTime - startTime).toFixed(2)}ms)<br>`;
                    
                } catch (error) {
                    log.innerHTML += `  <span class="error">âœ— å¤±è´¥: ${error.message}</span><br>`;
                }
            }
            
            log.innerHTML += '<br><span class="success">âœ“ å¤šé…è‰²æµ‹è¯•å®Œæˆï¼</span>';
        };
        
        // æ€§èƒ½æµ‹è¯•
        window.runPerformanceTest = async function() {
            const log = document.getElementById('performance-log');
            log.innerHTML = '<span class="warning">æ­£åœ¨è¿è¡Œæ€§èƒ½æµ‹è¯•...</span><br>';
            
            const testSizes = [100, 200, 300, 400, 500];
            const testContent = 'æ€§èƒ½æµ‹è¯•ï¼šPerformance Test æ€§èƒ½æµ‹è¯• 123456';
            
            for (const size of testSizes) {
                log.innerHTML += `<br><strong>å°ºå¯¸ ${size}x${size} æµ‹è¯•ï¼š</strong><br>`;
                
                try {
                    const testRenderer = new ZXingRenderer({
                        size: size,
                        foreground: '#000000',
                        background: '#FFFFFF',
                        errorCorrectionLevel: 'H',
                        margin: 0.5
                    });
                    
                    // æµ‹è¯•å¤šæ¬¡å–å¹³å‡å€¼
                    const times = [];
                    for (let i = 0; i < 3; i++) {
                        const startTime = performance.now();
                        await testRenderer.exportToPNG(testContent);
                        const endTime = performance.now();
                        times.push(endTime - startTime);
                    }
                    
                    const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                    log.innerHTML += `  å¹³å‡æ—¶é—´: <span class="success">${avgTime.toFixed(2)}ms</span><br>`;
                    
                } catch (error) {
                    log.innerHTML += `  <span class="error">âœ— å¤±è´¥: ${error.message}</span><br>`;
                }
            }
            
            log.innerHTML += '<br><span class="success">âœ“ æ€§èƒ½æµ‹è¯•å®Œæˆï¼</span>';
        };
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 