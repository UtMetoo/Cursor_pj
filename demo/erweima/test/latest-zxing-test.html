<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZXing.js 0.21.3 APIæµ‹è¯•</title>
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .qr-display { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .qr-container { display: inline-block; margin: 10px; text-align: center; }
        .qr-container svg { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>ZXing.js 0.21.3 APIæµ‹è¯•</h1>
    <div id="results"></div>
    <div id="qr-display" class="qr-display"></div>

    <script src="https://unpkg.com/@zxing/library@0.21.3/umd/index.min.js"></script>
    
    <script>
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }

        function testZXingLatest() {
            try {
                addResult('ZXing 0.21.3 å¯¹è±¡æ£€æŸ¥:', 'info');
                addResult('ZXing å­˜åœ¨: ' + (typeof ZXing !== 'undefined'));
                
                if (typeof ZXing === 'undefined') {
                    addResult('ZXing åº“æœªåŠ è½½', 'error');
                    return;
                }

                // æ£€æŸ¥å¯ç”¨çš„API
                addResult('APIæ£€æŸ¥:', 'info');
                const apis = [
                    'BrowserQRCodeSvgWriter',
                    'BrowserQRCodeReader', 
                    'MultiFormatReader',
                    'QRCodeWriter',
                    'BarcodeFormat',
                    'EncodeHintType',
                    'DecodeHintType'
                ];

                apis.forEach(api => {
                    const exists = typeof ZXing[api] !== 'undefined';
                    addResult(`${api}: ${exists ? 'âœ…' : 'âŒ'}`, exists ? 'success' : 'error');
                });

                // è¯¦ç»†æ£€æŸ¥BarcodeFormat
                if (typeof ZXing.BarcodeFormat !== 'undefined') {
                    addResult('BarcodeFormatè¯¦ç»†æ£€æŸ¥:', 'info');
                    addResult('BarcodeFormat.QR_CODE: ' + ZXing.BarcodeFormat.QR_CODE);
                    addResult('BarcodeFormatç±»å‹: ' + typeof ZXing.BarcodeFormat.QR_CODE);
                } else {
                    addResult('BarcodeFormatä¸å¯ç”¨', 'error');
                }

                // æ£€æŸ¥æ‰€æœ‰å¯ç”¨çš„ZXingå±æ€§
                addResult('ZXingå¯¹è±¡çš„æ‰€æœ‰å±æ€§:', 'info');
                const zxingProps = Object.getOwnPropertyNames(ZXing);
                addResult('å±æ€§æ•°é‡: ' + zxingProps.length);
                zxingProps.slice(0, 10).forEach(prop => {
                    addResult(`  ${prop}: ${typeof ZXing[prop]}`);
                });
                if (zxingProps.length > 10) {
                    addResult(`  ... è¿˜æœ‰${zxingProps.length - 10}ä¸ªå±æ€§`);
                }

                // æµ‹è¯• BrowserQRCodeSvgWriter
                addResult('BrowserQRCodeSvgWriter æµ‹è¯•:', 'info');
                try {
                    const writer = new ZXing.BrowserQRCodeSvgWriter();
                    addResult('Writer åˆ›å»ºæˆåŠŸ');
                    
                    // æµ‹è¯•ä¸åŒçš„å‚æ•°ç»„åˆ
                    const testCases = [
                        {
                            name: 'åŸºæœ¬è°ƒç”¨',
                            fn: () => writer.write('Hello World', 200, 200)
                        },
                        {
                            name: 'å¸¦ç©ºhintsçš„è°ƒç”¨',
                            fn: () => writer.write('Hello World', 200, 200, new Map())
                        },
                        {
                            name: 'å¸¦null hintsçš„è°ƒç”¨',
                            fn: () => writer.write('Hello World', 200, 200, null)
                        }
                    ];

                    testCases.forEach((testCase, index) => {
                        try {
                            const result = testCase.fn();
                            if (result && result instanceof SVGElement) {
                                addResult(`${testCase.name}: æˆåŠŸ âœ…`);
                                
                                // æ˜¾ç¤ºäºŒç»´ç 
                                const container = document.createElement('div');
                                container.className = 'qr-container';
                                container.innerHTML = `<h4>${testCase.name}</h4>`;
                                container.appendChild(result.cloneNode(true));
                                document.getElementById('qr-display').appendChild(container);
                            } else {
                                addResult(`${testCase.name}: è¿”å›å€¼æ— æ•ˆ`, 'error');
                            }
                        } catch (error) {
                            addResult(`${testCase.name}: å¤±è´¥ - ${error.message}`, 'error');
                            console.error(`${testCase.name} é”™è¯¯:`, error);
                        }
                    });

                } catch (error) {
                    addResult('Writer åˆ›å»ºå¤±è´¥: ' + error.message, 'error');
                }

                // æµ‹è¯• QRCodeWriter (å¦‚æœå­˜åœ¨) - ç®€åŒ–æµ‹è¯•
                if (typeof ZXing.QRCodeWriter !== 'undefined') {
                    addResult('QRCodeWriter æµ‹è¯•:', 'info');
                    addResult('âš ï¸ QRCodeWriter åœ¨ZXing.js 0.21.3ä¸­å¯èƒ½å­˜åœ¨APIå…¼å®¹æ€§é—®é¢˜', 'warning');
                    addResult('å»ºè®®ä½¿ç”¨ BrowserQRCodeSvgWriter æ›¿ä»£', 'info');
                } else {
                    addResult('QRCodeWriter ä¸å¯ç”¨', 'info');
                }

                // é¢å¤–æµ‹è¯•ï¼šéªŒè¯ BrowserQRCodeSvgWriter çš„ç¨³å®šæ€§
                addResult('BrowserQRCodeSvgWriter ç¨³å®šæ€§æµ‹è¯•:', 'info');
                try {
                    const writer2 = new ZXing.BrowserQRCodeSvgWriter();
                    const testResults = [];
                    
                    // æµ‹è¯•å¤šç§å†…å®¹ç±»å‹
                    const testContents = [
                        'Hello World',
                        'https://example.com',
                        'WIFI:T:WPA;S:TestNetwork;P:TestPassword;;',
                        'æµ‹è¯•ä¸­æ–‡å†…å®¹',
                        '1234567890',
                        'Special chars: @#$%^&*()'
                    ];
                    
                    testContents.forEach((content, index) => {
                        try {
                            const result = writer2.write(content, 150, 150);
                            if (result && result instanceof SVGElement) {
                                testResults.push(`âœ… å†…å®¹${index + 1}: æˆåŠŸ`);
                            } else {
                                testResults.push(`âŒ å†…å®¹${index + 1}: å¤±è´¥`);
                            }
                        } catch (error) {
                            testResults.push(`âŒ å†…å®¹${index + 1}: ${error.message}`);
                        }
                    });
                    
                    testResults.forEach(result => addResult(result));
                    
                } catch (error) {
                    addResult('BrowserQRCodeSvgWriter ç¨³å®šæ€§æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
                }

                // æµ‹è¯•æ€»ç»“
                addResult('æµ‹è¯•æ€»ç»“:', 'info');
                addResult('âœ… BrowserQRCodeSvgWriter å·¥ä½œæ­£å¸¸ï¼Œå»ºè®®ä½¿ç”¨æ­¤API', 'success');
                addResult('âš ï¸ QRCodeWriter åœ¨å½“å‰ç‰ˆæœ¬ä¸­å­˜åœ¨å…¼å®¹æ€§é—®é¢˜', 'warning');
                addResult('ğŸ’¡ å»ºè®®ï¼šåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ BrowserQRCodeSvgWriter è¿›è¡ŒäºŒç»´ç ç”Ÿæˆ', 'info');
                
            } catch (error) {
                addResult('æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: ' + error.message, 'error');
                console.error('æµ‹è¯•é”™è¯¯:', error);
            }
        }

        // ç­‰å¾…åº“åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            setTimeout(testZXingLatest, 200);
        });
    </script>
</body>
</html> 