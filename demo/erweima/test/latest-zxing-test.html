<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZXing.js 0.21.3 API测试</title>
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .qr-display { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .qr-container { display: inline-block; margin: 10px; text-align: center; }
        .qr-container svg { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>ZXing.js 0.21.3 API测试</h1>
    <div id="results"></div>
    <div id="qr-display" class="qr-display"></div>

    <script src="https://unpkg.com/@zxing/library@0.21.3/umd/index.min.js"></script>
    
    <script>
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }

        function testZXingLatest() {
            try {
                addResult('ZXing 0.21.3 对象检查:', 'info');
                addResult('ZXing 存在: ' + (typeof ZXing !== 'undefined'));
                
                if (typeof ZXing === 'undefined') {
                    addResult('ZXing 库未加载', 'error');
                    return;
                }

                // 检查可用的API
                addResult('API检查:', 'info');
                const apis = [
                    'BrowserQRCodeSvgWriter',
                    'BrowserQRCodeReader', 
                    'MultiFormatReader',
                    'QRCodeWriter',
                    'BarcodeFormat',
                    'EncodeHintType',
                    'DecodeHintType'
                ];

                apis.forEach(api => {
                    const exists = typeof ZXing[api] !== 'undefined';
                    addResult(`${api}: ${exists ? '✅' : '❌'}`, exists ? 'success' : 'error');
                });

                // 详细检查BarcodeFormat
                if (typeof ZXing.BarcodeFormat !== 'undefined') {
                    addResult('BarcodeFormat详细检查:', 'info');
                    addResult('BarcodeFormat.QR_CODE: ' + ZXing.BarcodeFormat.QR_CODE);
                    addResult('BarcodeFormat类型: ' + typeof ZXing.BarcodeFormat.QR_CODE);
                } else {
                    addResult('BarcodeFormat不可用', 'error');
                }

                // 检查所有可用的ZXing属性
                addResult('ZXing对象的所有属性:', 'info');
                const zxingProps = Object.getOwnPropertyNames(ZXing);
                addResult('属性数量: ' + zxingProps.length);
                zxingProps.slice(0, 10).forEach(prop => {
                    addResult(`  ${prop}: ${typeof ZXing[prop]}`);
                });
                if (zxingProps.length > 10) {
                    addResult(`  ... 还有${zxingProps.length - 10}个属性`);
                }

                // 测试 BrowserQRCodeSvgWriter
                addResult('BrowserQRCodeSvgWriter 测试:', 'info');
                try {
                    const writer = new ZXing.BrowserQRCodeSvgWriter();
                    addResult('Writer 创建成功');
                    
                    // 测试不同的参数组合
                    const testCases = [
                        {
                            name: '基本调用',
                            fn: () => writer.write('Hello World', 200, 200)
                        },
                        {
                            name: '带空hints的调用',
                            fn: () => writer.write('Hello World', 200, 200, new Map())
                        },
                        {
                            name: '带null hints的调用',
                            fn: () => writer.write('Hello World', 200, 200, null)
                        }
                    ];

                    testCases.forEach((testCase, index) => {
                        try {
                            const result = testCase.fn();
                            if (result && result instanceof SVGElement) {
                                addResult(`${testCase.name}: 成功 ✅`);
                                
                                // 显示二维码
                                const container = document.createElement('div');
                                container.className = 'qr-container';
                                container.innerHTML = `<h4>${testCase.name}</h4>`;
                                container.appendChild(result.cloneNode(true));
                                document.getElementById('qr-display').appendChild(container);
                            } else {
                                addResult(`${testCase.name}: 返回值无效`, 'error');
                            }
                        } catch (error) {
                            addResult(`${testCase.name}: 失败 - ${error.message}`, 'error');
                            console.error(`${testCase.name} 错误:`, error);
                        }
                    });

                } catch (error) {
                    addResult('Writer 创建失败: ' + error.message, 'error');
                }

                // 测试 QRCodeWriter (如果存在) - 简化测试
                if (typeof ZXing.QRCodeWriter !== 'undefined') {
                    addResult('QRCodeWriter 测试:', 'info');
                    addResult('⚠️ QRCodeWriter 在ZXing.js 0.21.3中可能存在API兼容性问题', 'warning');
                    addResult('建议使用 BrowserQRCodeSvgWriter 替代', 'info');
                } else {
                    addResult('QRCodeWriter 不可用', 'info');
                }

                // 额外测试：验证 BrowserQRCodeSvgWriter 的稳定性
                addResult('BrowserQRCodeSvgWriter 稳定性测试:', 'info');
                try {
                    const writer2 = new ZXing.BrowserQRCodeSvgWriter();
                    const testResults = [];
                    
                    // 测试多种内容类型
                    const testContents = [
                        'Hello World',
                        'https://example.com',
                        'WIFI:T:WPA;S:TestNetwork;P:TestPassword;;',
                        '测试中文内容',
                        '1234567890',
                        'Special chars: @#$%^&*()'
                    ];
                    
                    testContents.forEach((content, index) => {
                        try {
                            const result = writer2.write(content, 150, 150);
                            if (result && result instanceof SVGElement) {
                                testResults.push(`✅ 内容${index + 1}: 成功`);
                            } else {
                                testResults.push(`❌ 内容${index + 1}: 失败`);
                            }
                        } catch (error) {
                            testResults.push(`❌ 内容${index + 1}: ${error.message}`);
                        }
                    });
                    
                    testResults.forEach(result => addResult(result));
                    
                } catch (error) {
                    addResult('BrowserQRCodeSvgWriter 稳定性测试失败: ' + error.message, 'error');
                }

                // 测试总结
                addResult('测试总结:', 'info');
                addResult('✅ BrowserQRCodeSvgWriter 工作正常，建议使用此API', 'success');
                addResult('⚠️ QRCodeWriter 在当前版本中存在兼容性问题', 'warning');
                addResult('💡 建议：在实际项目中使用 BrowserQRCodeSvgWriter 进行二维码生成', 'info');
                
            } catch (error) {
                addResult('测试过程中出错: ' + error.message, 'error');
                console.error('测试错误:', error);
            }
        }

        // 等待库加载完成
        window.addEventListener('load', () => {
            setTimeout(testZXingLatest, 200);
        });
    </script>
</body>
</html> 